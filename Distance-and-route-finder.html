<!DOCTYPE html>
<html>
  <head>
      <title>Distance and Route Finder</title>
  </head>
  <body style="margin:0;height:100%;min-height:100vh;">
    <div style="display:flex; flex-direction:row;height:100%;min-height:100vh;">
      <div style="width:15%;background-color: #18191a;">
        
      </div>

      <div style="width:70%;padding: 10px;">
        <h1 style="display:flex; justify-content:center;">Distance and Route Finder using Google Maps APIs</h1>

        <div style=" width:50%; margin-left: 25%;">
          <div style="display:flex; flex-direction:row;width:100%; ">
            <div style="background-color: gray;min-width: 135px;color: beige; padding: 2px; margin-right: 5px;">Origin address:</div>
            <div style="width:100%">
              <input type="text" style="width:100%" id="origin-add" placeholder="Enter origin address" /> 
            </div>
          </div>
          <div style="display:flex; flex-direction:row; margin-top: 4px;">
            <div style="background-color: gray; min-width: 135px; color: beige; padding: 2px; margin-right: 5px;">Destination address:</div>
            <div style="width:100%">
              <input type="text" id="dest-add" style="width:100%" placeholder="Enter destination address" /> 
            </div>
          </div>
        </div>

        <div style="display:flex; flex-direction:row; justify-content: space-between; margin: 30px 0 10px 28%; width: 44%;">
          <div>Select Travel mode:</div>
          <div style="display:flex; flex-direction:row;">
            <div>
              <input type="radio" id="travel-driving" name="travel-mode" value="DRIVING" style="cursor: pointer;" checked>
            </div>
            <div>
              <label for="DRIVING">Driving</label>
            </div>
            <div>
              <input type="radio" id="travel-walking" name="travel-mode" value="WALKING" style="cursor: pointer;">
            </div>
            <div>
              <label for="WALKING">Walking</label>
            </div>
            <div>
              <input type="radio" id="travel-bicycling" name="travel-mode" value="BICYCLING" style="cursor: pointer;">
            </div>
            <div>
              <label for="BICYCLING">Bicycling</label>
            </div>
            <div>
              <input type="radio" id="travel-transit" name="travel-mode" value="TRANSIT" style="cursor: pointer;">
            </div>
            <div>
              <label for="TRANSIT">Transit</label>
            </div>
          </div>          
        </div>

        <div>
          <button id="show-route-btn" style="background-color:darkcyan; border: 0cm; font-weight: 780; border-radius: 5px; height:30px; cursor: pointer; width:30%; margin-left: 35%;">Show Route Details</button>
        </div>

        <div id="show-details-box" style="border: 0.02cm; border-color:grey;border-style: solid; border-radius: 2px; width:60%; margin-top: 20px; margin-left: 20%; padding:0;">

          <div style="display:flex; flex-direction:row; justify-content:space-between; border: 0;">
            <div style="width:20%; background-color:#0091BF;color: beige; padding: 4px 0 0 6px;">From:</div>
            <div id="from_place" style="font-weight: bold; padding: 4px 6px 0 0;"></div>
          </div>

          <div style="display:flex; flex-direction:row;justify-content:space-between;">            
            <div style="width:20%; background-color:#0091BF;color: beige; padding-left: 6px;">To:</div>
            <div id="to_place" style="font-weight: bold; padding-right: 6px;"></div>
          </div>

          <div style="display:flex; flex-direction:row;justify-content:space-between;">
            <div style="width:20%; background-color:#0091BF;color: beige; padding-left: 6px;">Distance (in kms): </div>
            <div id="response_distance" style="font-weight: bold; padding-right: 6px;"></div>    
          </div>

          <div style="display:flex; flex-direction:row;justify-content:space-between;">
            <div style="width:20%; background-color:#0091BF;color: beige; padding: 0 0 4px 6px;">Travel time: </div>
            <div id="response_time" style="font-weight: bold; padding: 0 6px 4px 0;"></div>   
          </div>

        </div>

        <div id="no-route" style="margin: 20px 0 20px 0">
          <div style="color: #8B0000; display:flex; justify-content:center;font-size: xx-large;">No Route Found!</div>
          <div style="display:flex; justify-content:center; font-size: larger;">Try searching again for different addresses.</div>
        </div>

        <div id="googleMap" style="width:100%;height:400px;margin-top: 10px;"></div>
      </div>

      <div style="width:15%;background-color: #18191a;">

      </div>
    </div>

    <script>

    var showDetails = 0;

    document.getElementById('show-details-box').style.display = 'none';  
    document.getElementById('no-route').style.display = 'none';  

    const initMap = () => {
      var mapProp= {
        center:new google.maps.LatLng(-33.8688, 151.2093),
        zoom:10,
      };

      var directionsService = new google.maps.DirectionsService();
      var directionsRenderer = new google.maps.DirectionsRenderer();
      var distanceService = new google.maps.DistanceMatrixService();

      var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
      directionsRenderer.setMap(map);
      
      //var marker = new google.maps.Marker({position: new google.maps.LatLng(-33.8688, 151.2093)});
      //marker.setMap(map);

      var origin = document.getElementById('origin-add');
      var autocompleteOrigin = new google.maps.places.Autocomplete(origin);

      var dest = document.getElementById('dest-add');
      var autocompleteDest = new google.maps.places.Autocomplete(dest);

      console.log(autocompleteOrigin, autocompleteDest)

      autocompleteOrigin.addListener('place_changed', function () {
        var place = autocompleteOrigin.getPlace();

        console.log(place)
        console.log(document.getElementById('origin-add').value)

      });

      //map.setTilt(90);

      document.getElementById('show-route-btn').addEventListener('click', () => {
        var placeOrigin = autocompleteOrigin.getPlace();
        console.log(placeOrigin)
        var placeDest = autocompleteDest.getPlace();
        console.log(placeDest)

        var start = document.getElementById('origin-add').value;
        var end = document.getElementById('dest-add').value;
        var selectedMode = document.querySelector('input[name="travel-mode"]:checked').value;
        
        var request = {
          origin: start,
          destination: end,
          travelMode: selectedMode
        };
        directionsService.route(request, (result, status) => {
          if (status == 'OK') {
            console.log(result)
            directionsRenderer.setDirections(result);
            document.getElementById('show-details-box').style.display = 'block';  
            document.getElementById('no-route').style.display = 'none';  
          } else {          
            directionsRenderer.setDirections({routes: []});
            document.getElementById('show-details-box').style.display = 'none';  
            document.getElementById('no-route').style.display = 'block';  
          }
        });

        const distanceRequest = {
          origins: [start],
          destinations: [end],
          travelMode: selectedMode,
          avoidHighways: false,
          avoidTolls: false,
        };

        distanceService.getDistanceMatrix(distanceRequest).then((response) => {
          if (response !== null){
            if (response.rows[0].elements[0].status === 'OK'){
              console.log(response.rows[0].elements[0].distance)   
              console.log(response.rows[0].elements[0].duration) 
              document.getElementById('from_place').innerText = document.getElementById('origin-add').value
              document.getElementById('to_place').innerText = document.getElementById('dest-add').value
              document.getElementById('response_distance').innerText = response.rows[0].elements[0].distance.text
              document.getElementById('response_time').innerText = response.rows[0].elements[0].duration.text
            }   
            else {
              console.log('Route Distance not found')
            }
          }  
        })
        .catch((error) => {
          console.log(error);
        });

      });
    }

    window.initMap = initMap;
    // Future enhancements:
    // Add departure time
    // Add intermediate locations
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFXE4uCIRzYbp6-4SkxOiggphLOW0U9FM&libraries=places&callback=initMap"></script>

  </body>
</html>